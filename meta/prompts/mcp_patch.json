{
  "task": "Enable multi-client socket support and align docs",
  "objective": "Upgrade the socket server to handle multiple concurrent clients, add regression tests for multi-client operation, and fix documentation mismatches in serving instructions.",
  "changes": [
    {
      "id": "socket_multi_client",
      "description": "Refactor socket server to support multiple concurrent clients instead of blocking on one connection.",
      "edits": [
        "mcp/socket_main.py:32 — Replace listen(1) with listen(backlog) and accept loop that dispatches each connection in a separate thread or selector task.",
        "mcp/socket_main.py:52 — Move blocking _serve_connection into per-connection handler, ensuring FIFO order per client while allowing multiple clients at once.",
        "mcp/socket_main.py:43 — Ensure socket file is unlinked only once on shutdown, not per connection.",
        "tests/test_socket.py — Add test that spawns two concurrent client connections, sends interleaved requests, and asserts both clients receive valid sequential responses without blocking."
      ]
    },
    {
      "id": "readme_serve_fix",
      "description": "Correct README serve instructions so operators get accurate startup guidance.",
      "edits": [
        "README.md:42 — Replace './serve.sh' reference with './up.sh' or document an actual serve.sh shim if added.",
        "README.md:169 — Clarify that up.sh builds and starts the service but does not tail logs; suggest 'docker compose logs -f serve' if tailing is desired.",
        "up.sh:6 — Optionally add a comment clarifying log behavior so docs and script stay consistent."
      ]
    }
  ],
  "constraints": {
    "rules": [
      "No new external dependencies; use only stdlib (threading, selectors, socket).",
      "Preserve existing 1 MiB guard, payload validation, and logging semantics.",
      "Each client connection must maintain strict FIFO ordering of its own requests and responses.",
      "Tests must cover simultaneous client connections to confirm concurrency works.",
      "README instructions must match the scripts in the repo."
    ]
  },
  "exit_criteria": [
    "Socket server accepts multiple concurrent clients without blocking; per-connection ordering is preserved.",
    "Integration tests pass with two simultaneous socket clients sending interleaved requests.",
    "README has no stale references to serve.sh and correctly describes up.sh behavior.",
    "All existing tests remain green alongside the new concurrency tests."
  ]
}
