{
  "task": "Add hardening tests for MCP v0.2.6.1",
  "objective": "Close remaining test gaps by asserting STDIO ready-file cleanup, exercising TCP multi-client ordering, and verifying ephemeral port logging with MCP_PORT=0.",
  "changes": [
    {
      "id": "stdio_readyfile_cleanup",
      "description": "Add assertion that shutdown removes the ready file.",
      "edits": [
        "tests/test_stdio.py: extend shutdown test to assert MCP_READY_FILE no longer exists after process exit."
      ]
    },
    {
      "id": "tcp_multi_client",
      "description": "Add regression test for concurrent TCP clients.",
      "edits": [
        "tests/test_tcp.py: spawn two or more client threads, issue requests concurrently, and assert per-connection ordering is preserved and server cleans up threads."
      ]
    },
    {
      "id": "tcp_ephemeral_port",
      "description": "Add regression test for MCP_PORT=0 ephemeral port logging.",
      "edits": [
        "tests/test_tcp.py: set MCP_PORT=0, start server, parse readiness log for actual bound port, assert it is nonzero and connections succeed."
      ]
    }
  ],
  "constraints": {
    "rules": [
      "No changes to core code, docs, or spec â€” tests only.",
      "Reuse pytest fixtures and helpers where possible.",
      "Use temp files/ports safely and clean up in test teardown.",
      "Tests must pass deterministically across CI runs."
    ]
  },
  "exit_criteria": [
    "tests/test_stdio.py asserts ready-file removal after shutdown.",
    "tests/test_tcp.py includes multi-client concurrency test.",
    "tests/test_tcp.py includes ephemeral port (MCP_PORT=0) logging test.",
    "pytest -q passes with all new tests green."
  ]
}
